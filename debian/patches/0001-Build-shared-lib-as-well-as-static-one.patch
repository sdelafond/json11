From: =?utf-8?q?S=C3=A9bastien_Delafond?= <sdelafond@gmail.com>
Date: Wed, 18 Dec 2019 10:36:02 +0100
Subject: Build shared lib as well as static one

---
 CMakeLists.txt | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 64116d6..182728b 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -22,8 +22,15 @@ if(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
   set(CMAKE_INSTALL_PREFIX /usr)
 endif()
 
-add_library(json11 json11.cpp)
+add_library(json11_static STATIC json11.cpp)
+set_target_properties(json11_static PROPERTIES OUTPUT_NAME json11)
+add_library(json11 SHARED json11.cpp)
+set_target_properties(json11 PROPERTIES VERSION 1.0.0 SOVERSION 1)
+
+target_include_directories(json11_static PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
 target_include_directories(json11 PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
+target_compile_options(json11_static
+  PRIVATE -fPIC -fno-rtti -fno-exceptions -Wall)
 target_compile_options(json11
   PRIVATE -fPIC -fno-rtti -fno-exceptions -Wall)
 
@@ -34,6 +41,7 @@ foreach(_warning_flag ${_possible_warnings_flags})
   unset(_flag_supported)
   CHECK_CXX_COMPILER_FLAG(${_warning_flag} _flag_supported)
   if(${_flag_supported})
+    target_compile_options(json11_static PRIVATE ${_warning_flag})
     target_compile_options(json11 PRIVATE ${_warning_flag})
   endif()
 endforeach()
@@ -53,6 +61,7 @@ if (JSON11_BUILD_TESTS)
   target_link_libraries(json11_test json11)
 endif()
 
+install(TARGETS json11_static DESTINATION lib/${CMAKE_LIBRARY_ARCHITECTURE})
 install(TARGETS json11 DESTINATION lib/${CMAKE_LIBRARY_ARCHITECTURE})
 install(FILES "${CMAKE_CURRENT_SOURCE_DIR}/json11.hpp" DESTINATION include/${CMAKE_LIBRARY_ARCHITECTURE})
 install(FILES "${CMAKE_CURRENT_BINARY_DIR}/json11.pc" DESTINATION lib/${CMAKE_LIBRARY_ARCHITECTURE}/pkgconfig)
